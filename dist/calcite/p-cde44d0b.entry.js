import{r as t,c as i,h as e,H as a,g as s}from"./p-ff68592a.js";import{g as o}from"./p-fbd3d700.js";import{g as r}from"./p-94f961af.js";import{d as c}from"./p-fc8feabd.js";import{f as n}from"./p-c10ca461.js";import{u as l,c as p,C as h}from"./p-e51c1c92.js";const m=class{constructor(e){t(this,e),this.calciteLookupChange=i(this,"calciteLookupChange",7),this.calciteComboboxChipDismiss=i(this,"calciteComboboxChipDismiss",7),this.active=!1,this.disabled=!1,this.maxItems=0,this.scale="m",this.items=[],this.selectedItems=[],this.visibleItems=[],this.textInput=null,this.observer=null,this.maxScrollerHeight=0,this.setInactiveIfNotContained=t=>{this.active&&!this.el.contains(t)&&(this.active=!1)},this.setMenuEl=t=>{this.menuEl=t},this.setReferenceEl=t=>{this.referenceEl=t},this.inputHandler=t=>{this.filterItems(t.target.value)},this.handleInputKeyDown=t=>{if(t.target===this.textInput){const i=r(t.key);if(t.shiftKey&&"Tab"===i)return;"Escape"===i?this.active=!1:"ArrowDown"===i?this.focusFirstItem():"ArrowUp"===i?this.focusLastItem():(this.active=!0,this.textInput.focus())}},this.filterItems=c((t=>{const i=((t,i)=>{const e=new RegExp(i,"ig");0===t.length&&console.warn("No data was passed to the filter function.\n    The data argument should be an array of objects");const a=(t,i)=>{let e=!1;return n(t,(t=>{"function"!=typeof t&&(Array.isArray(t)||"object"==typeof t&&null!==t?a(t,i)&&(e=!0):i.test(t)&&(e=!0))})),e};return t.filter((t=>a(t,e)))})(this.data,t).map((t=>t.value));this.items.forEach((t=>{t.hidden=-1===i.indexOf(t.value);const{parentItem:e}=t;e&&(-1!==i.indexOf(e.value)&&(t.hidden=!1),-1!==i.indexOf(t.value)&&(e.hidden=!1))})),this.visibleItems=this.getVisibleItems()}),100),this.comboboxFocusHandler=()=>{this.active=!0},this.comboboxBlurHandler=t=>{this.setInactiveIfNotContained(t.relatedTarget)}}activeHandler(){this.reposition()}connectedCallback(){this.observer=new MutationObserver(this.updateItems),this.createPopper()}componentWillLoad(){this.updateItems()}componentDidLoad(){var t;null===(t=this.observer)||void 0===t||t.observe(this.el,{childList:!0,subtree:!0}),this.maxScrollerHeight=this.getMaxScrollerHeight(this.items)}disconnectedCallback(){var t;null===(t=this.observer)||void 0===t||t.disconnect(),this.destroyPopper()}async reposition(){const{popper:t,menuEl:i}=this,e=this.getModifiers();t?l({el:i,modifiers:e,placement:"bottom-start",popper:t}):this.createPopper()}documentClickHandler(t){this.setInactiveIfNotContained(t.target)}calciteComboboxItemChangeHandler(t){this.toggleSelection(t.detail)}calciteChipDismissHandler(t){var i;this.active=!1;const e=null===(i=t.detail)||void 0===i?void 0:i.value,a=this.items.find((t=>t.value===e));a&&this.toggleSelection(a,!1),this.calciteComboboxChipDismiss.emit(t.detail)}getModifiers(){return[{name:"flip",enabled:!0,options:{fallbackPlacements:["top-start","top","top-end","bottom-start","bottom","bottom-end"]}}]}createPopper(){this.destroyPopper();const{menuEl:t,referenceEl:i}=this,e=this.getModifiers();this.popper=p({el:t,modifiers:e,placement:"bottom-start",referenceEl:i})}destroyPopper(){const{popper:t}=this;t&&t.destroy(),this.popper=null}getMaxScrollerHeight(t){const{maxItems:i}=this;let e=0,a=0;return t.forEach((t=>{e<i&&i>0&&(a+=t.offsetHeight,e+=1,t.querySelectorAll("calcite-combobox-item").forEach((t=>{a-=t.offsetHeight})))})),a}toggleSelection(t,i=!t.selected){t.selected=i,this.selectedItems=this.getSelectedItems(),this.calciteLookupChange.emit(this.selectedItems)}getVisibleItems(){return this.items.filter((t=>!t.hidden))}getSelectedItems(){return this.items.filter((t=>t.selected))}updateItems(){this.items=this.getItems(),this.data=this.getData(),this.selectedItems=this.getSelectedItems(),this.visibleItems=this.getVisibleItems()}getData(){return this.items.map((t=>({value:t.value,label:t.textLabel})))}getItems(){return Array.from(this.el.querySelectorAll("calcite-combobox-item")).filter((t=>!t.disabled)).map((t=>{const{parentElement:i}=t;return t.parentItem=i.matches("calcite-combobox-item")?i:null,t}))}calciteComboboxItemKeyEventHandler(t){const{item:i,event:e}=t.detail,a=0===this.itemIndex(i),s=this.itemIndex(i)===this.items.length-1,o=e.shiftKey;switch(r(e.key)){case"Tab":a&&o&&this.closeCalciteCombobox(),s&&!o?this.closeCalciteCombobox():a&&o?this.textInput.focus():o?this.focusPrevItem(i):this.focusNextItem(i);break;case"ArrowDown":this.focusNextItem(i);break;case"ArrowUp":this.focusPrevItem(i);break;case"Home":this.focusFirstItem();break;case"End":this.focusLastItem();break;case"Escape":this.closeCalciteCombobox()}}closeCalciteCombobox(){this.textInput.focus(),this.active=!1}focusFirstItem(){this.items[0].focus()}focusLastItem(){this.items[this.items.length-1].focus()}focusNextItem(t){const i=this.itemIndex(t);(this.items[i+1]||this.items[0]).focus()}focusPrevItem(t){const i=this.itemIndex(t);(this.items[i-1]||this.items[this.items.length-1]).focus()}itemIndex(t){return this.items.indexOf(t)}render(){const{active:t,disabled:i,el:s,label:r,placeholder:c,scale:n,selectedItems:l,maxScrollerHeight:p}=this,m=o(s),b="listbox";return e(a,{active:t,dir:m},e("div",{class:"selections"},l.map((t=>e("calcite-chip",{dir:m,dismissible:!0,key:t.value,scale:n,value:t.value},t.textLabel)))),e("div",{"aria-expanded":t.toString(),"aria-haspopup":"listbox","aria-owns":b,ref:this.setReferenceEl,role:"combobox"},e("input",{"aria-autocomplete":"list","aria-controls":b,"aria-label":r,disabled:i,onBlur:this.comboboxBlurHandler,onFocus:this.comboboxFocusHandler,onInput:this.inputHandler,onKeyDown:this.handleInputKeyDown,placeholder:c,ref:t=>this.textInput=t,type:"text"})),e("div",{"aria-hidden":(!t).toString(),class:"list-container",ref:this.setMenuEl},e("ul",{"aria-label":r,"aria-multiselectable":"true",class:{list:!0,[h.animation]:!0,[h.animationActive]:t},id:b,role:"listbox",style:{maxHeight:p>0?p+"px":""}},e("slot",null))))}get el(){return s(this)}static get watchers(){return{active:["activeHandler"]}}};m.style="@-webkit-keyframes calcite-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes calcite-fade-in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes calcite-fade-in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes calcite-fade-in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes calcite-fade-in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes calcite-fade-in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes calcite-fade-in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes calcite-fade-in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-popper-transition:150ms ease-in-out}:host([hidden]){display:none}:host{display:block;position:relative}:host-context([theme=dark]){--calcite-ui-blue-1:#00A0FF;--calcite-ui-blue-2:#0087D7;--calcite-ui-blue-3:#47BBFF;--calcite-ui-green-1:#36DA43;--calcite-ui-green-2:#11AD1D;--calcite-ui-green-3:#44ED51;--calcite-ui-yellow-1:#FFC900;--calcite-ui-yellow-2:#F4B000;--calcite-ui-yellow-3:#FFE24D;--calcite-ui-red-1:#FE583E;--calcite-ui-red-2:#F3381B;--calcite-ui-red-3:#FF7465;--calcite-ui-background:#202020;--calcite-ui-foreground-1:#2b2b2b;--calcite-ui-foreground-2:#353535;--calcite-ui-foreground-3:#404040;--calcite-ui-text-1:#ffffff;--calcite-ui-text-2:#bfbfbf;--calcite-ui-text-3:#9f9f9f;--calcite-ui-border-1:#4a4a4a;--calcite-ui-border-2:#404040;--calcite-ui-border-3:#353535;--calcite-ui-border-4:#757575;--calcite-ui-border-5:#9f9f9f}:host([scale=s]){font-size:12px;--calcite-combobox-item-spacing-unit-l:12px;--calcite-combobox-item-spacing-unit-s:8px}:host([scale=m]){font-size:14px;--calcite-combobox-item-spacing-unit-l:16px;--calcite-combobox-item-spacing-unit-s:12px}:host([scale=l]){font-size:16px;--calcite-combobox-item-spacing-unit-l:20px;--calcite-combobox-item-spacing-unit-s:16px}[role=combobox]{display:-ms-flexbox;display:flex}input{-ms-flex-positive:1;flex-grow:1;font-size:inherit;font-family:inherit;padding:var(--calcite-combobox-item-spacing-unit-s) var(--calcite-combobox-item-spacing-unit-l);background-color:var(--calcite-ui-foreground-1);border:1px solid var(--calcite-ui-border-1);color:1px solid var(--calcite-ui-text-1);outline-offset:0;outline-color:transparent;-webkit-transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out}input:focus{outline:2px solid var(--calcite-ui-blue-1);outline-offset:-2px}.list-container{display:block;position:absolute;z-index:999;top:-999999px;visibility:hidden;pointer-events:none}.list-container .calcite-popper-anim{position:relative;z-index:1;-webkit-transition:var(--calcite-popper-transition);transition:var(--calcite-popper-transition);visibility:hidden;-webkit-transition-property:visibility, opacity, -webkit-transform;transition-property:visibility, opacity, -webkit-transform;transition-property:transform, visibility, opacity;transition-property:transform, visibility, opacity, -webkit-transform;opacity:0;-webkit-box-shadow:0 0 16px 0 rgba(0, 0, 0, 0.16);box-shadow:0 0 16px 0 rgba(0, 0, 0, 0.16);border-radius:var(--calcite-border-radius)}.list-container[data-popper-placement^=bottom] .calcite-popper-anim{-webkit-transform:translateY(-5px);transform:translateY(-5px)}.list-container[data-popper-placement^=top] .calcite-popper-anim{-webkit-transform:translateY(5px);transform:translateY(5px)}.list-container[data-popper-placement^=left] .calcite-popper-anim{-webkit-transform:translateX(5px);transform:translateX(5px)}.list-container[data-popper-placement^=right] .calcite-popper-anim{-webkit-transform:translateX(-5px);transform:translateX(-5px)}.list-container[data-popper-placement] .calcite-popper-anim--active{opacity:1;visibility:visible;-webkit-transform:translate(0);transform:translate(0)}:host([active]) .list-container{width:100%;pointer-events:initial;visibility:visible}.list{display:block;margin:0;padding:0;max-height:100vh;width:var(--calcite-dropdown-width);background:var(--calcite-ui-foreground-1);overflow:hidden;overflow-y:scroll}.selections calcite-chip{margin-right:var(--calcite-combobox-item-spacing-unit-s);margin-bottom:var(--calcite-combobox-item-spacing-unit-s)}.selections calcite-chip:last-child{margin-right:0}:host([dir=rtl]) .selections calcite-chip{margin-right:unset;margin-left:var(--calcite-combobox-item-spacing-unit-s)}:host([dir=rtl]) .selections calcite-chip:last-child{margin-left:0}.item{display:block}";export{m as calcite_combobox}